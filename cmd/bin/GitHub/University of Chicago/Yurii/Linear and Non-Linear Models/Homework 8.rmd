---
title: "Week 8 Linear and NonLinear"
author: "Adham Suliman"
date: "August 16, 2018"
output: html_document
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
options(width = 100, warn = 0)
if(!"pacman" %in% rownames(installed.packages())) {
  install.packages("pacman")
}
pacman::p_load(tidyverse,faraway,corrplot, tinytex, dplyr,zoo, knitr, rgl, relaimpo, MuMIn, broom,ggplot2, tidyr, fields, cluster, data.table, reshape2,poLCA, stats, AER, MASS, pscl, faraway, pscl, lattice, latticeExtra, copula,lme4, lattice, arm)
```


```{r}
MarketingData <- read.csv('MarketingExperiment.csv')
head(MarketingData)
plot(MarketingData$Time,MarketingData$Probability, type="p",pch=19,xlab="Time",ylab="Probability")
```

```{r}
lmProbabilityTime<-lm(Probability~Time,data=MarketingData)
lmProbabilityTime$coefficients
```

```{r}
summary(lmProbabilityTime)
```

```{r}
residuals<-lmProbabilityTime$residuals
plot(MarketingData$Time,residuals)
```

```{r}
density.Residuals<-density(residuals)
plot(density.Residuals,ylim=c(0,10))
lines(density.Residuals$x,dnorm(density.Residuals$x,mean=mean(residuals),sd=sd(residuals)))
```


```{r}
lmProbabilityTimeGender<-lm(Probability~Time+Gender,data=MarketingData)
summary(lmProbabilityTimeGender)
```





Intercept is significant of females, but males are non-significant so it's the girls making the difference?
```{r}
lmTimeGender<-lm(Time~Gender,data=MarketingData)
summary(lmTimeGender)
Manual<-aggregate(MarketingData$Time,
                         by=list(MarketingData$Gender),
                         function(z) mean(z))$x
Manual
```



```{r}
fixedEffects<-c(lmTimeGender$coefficients[1],sum(lmTimeGender$coefficients))
(fixedEffects<-fixedEffects-mean(fixedEffects))
```

```{r}
library("lme4")
head(MarketingData)
lmerTimeGender<-lmer(Probability~Time+(1|Gender),data=MarketingData)
summary(lmerTimeGender)$coefficients
lmProbabilityTimeGender$coefficients
```


```{r}
data <- read.table(paste('Week8_Test_Sample.csv',sep = '/'), header=TRUE)
head(data)
```

1
```{r}
mFixedEffects <- lm(Response~Predictor1 + Predictor2,data)
```

2
```{r}
mRandomEffects <- lmer(Response~Predictor1+(1|Predictor2),data)
```

3
```{r}
mFixedEffects$coefficients
length(mFixedEffects$coefficients[1]+mFixedEffects$coefficients[c(-1,-2)])
mFixedEffects$coefficients[c(-1,-2)]
mFixedEffects$coefficients[1]+mFixedEffects$coefficients[c(-1,-2)]
(fixedEffects <- c(mFixedEffects$coefficients[1], mFixedEffects$coefficients[1]+mFixedEffects$coefficients[c(-1,-2)]))
(fixedEffects <- c(mFixedEffects$coefficients[1], mFixedEffects$coefficients[1]+mFixedEffects$coefficients[c(-1,-2)]))
(fixedEffects <- fixedEffects - mean(fixedEffects)) #assumes all group sizes are equal to do this
length(fixedEffects)
```

4
```{r}
randomEffects <- ranef(mRandomEffects)
randomEffects
```


```{r}
Kappa <- sd(unlist(randomEffects))/sd(unlist(fixedEffects))
```

```{r}
res <- list(fixedEffects = fixedEffects,
            randomEffects = randomEffects,
            Kappa = Kappa
            )
res
saveRDS(res, file = paste('result.rds',sep = '/'))
```

Create object mFixedEffects by fitting model with fixed effects for levels of Predictor2 using lm()
Create object mRandomEffects by fitting model with random effects for intercepts of Predictor2 using lmer()
Create variable fixedEffects of intercepts corresponding to different levels of Predictor2 using mFixedEffects
Create variable randomEffects corresponding to different levels of Predictor2 using mRandomEffects
Calculate amount of shrinkage in random effects model Kappa as shrinkage coefficient κ:
κ=σrσf,
where σr is standard deviation of randomEffects and σf is standard deviation of fixedEffects
Create list variable res.

res <- list(fixedEffects = fixedEffects,
            randomEffects = randomEffects,
            Kappa = Kappa
            )
Save res to a file and upload the file using left sidebar.

saveRDS(res, file = paste(dataPath,'result.rds',sep = '/'))


```{r}
lmerTimeGender<-lmer(Probability~Time+(1|Gender)-1,data=MarketingData)
names(summary(lmerTimeGender))
summary(lmerTimeGender)$sigma
lmCoeff <- summary(lmerTimeGender)$coefficients
(lmCoeff<-lmerTimeGender$coefficients)
lmCoeff
#3) Unique.fitted in workshop
#4) Ranef
```



```{r}
mFixedEffects <- 
```




