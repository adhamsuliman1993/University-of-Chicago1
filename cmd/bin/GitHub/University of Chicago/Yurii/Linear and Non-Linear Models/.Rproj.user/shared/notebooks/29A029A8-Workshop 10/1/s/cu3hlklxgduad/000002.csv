"0","library(animation)"
"0","lambda=5"
"0","oopt = ani.options(interval = .5, nmax = 25) ## set some options first"
"2","animation option 'nmax' changed: 50 --> 25
"
"0","MC.Matrix<-rbind("
"0","From.Pos1=c(To.Pos1=1,To.Pos2=0,To.Pos3=0,To.Pos4=0),"
"0","                 From.Pos2=c(To.Pos1=.0,To.Pos2=0.9,To.Pos3=0,To.Pos4=0.1),"
"0","                 From.Pos3=c(To.Pos1=0,To.Pos2=.0,To.Pos3=0.9,To.Pos4=.0),"
"0","                 From.Pos4=c(To.Pos1=0.9,To.Pos2=0,To.Pos3=0.1,To.Pos4=1))"
"0","Current.State<-2"
"0","From.To<-rep(Current.State,2)"
"0","my.Data<-as.matrix(t(c(0,2)))   ## use loop to create images one by one"
"0","for (i in 1:ani.options(""nmax"")) {"
"0","  From.To[1]<-Current.State"
"0","  From.To[2]<-sample(1:4,1,prob=MC.Matrix[From.To[1],])"
"0","  Current.State<-From.To[2]"
"0","  "
"0","  wait.next<-rexp(1,lambda)"
"0","  my.Data<-rbind(my.Data,c(my.Data[length(my.Data[,1]),1]+1,From.To[2]))"
"0","  plot(my.Data,type=""s"",xlim=c(1,25),ylim=c(0,4),xlab=""Time"",ylab=""State"",lwd=3)"
"0","  abline(h=1,col=""red"")"
"0","  abline(h=4,col=""red"")"
"0","  ani.pause(wait.next)    ## pause for a while ('interval')"
"0","  "
"0","}"
